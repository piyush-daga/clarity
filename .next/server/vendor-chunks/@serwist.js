"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@serwist";
exports.ids = ["vendor-chunks/@serwist"];
exports.modules = {

/***/ "(ssr)/./node_modules/@serwist/window/dist/index.internal.js":
/*!*************************************************************!*\
  !*** ./node_modules/@serwist/window/dist/index.internal.js ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isCurrentPageOutOfScope: () => (/* binding */ isCurrentPageOutOfScope)\n/* harmony export */ });\nconst isCurrentPageOutOfScope = (scope)=>{\n    const scopeURL = new URL(scope, document.baseURI);\n    const scopeURLBasePath = new URL(\"./\", scopeURL.href).pathname;\n    return !location.pathname.startsWith(scopeURLBasePath);\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHNlcndpc3Qvd2luZG93L2Rpc3QvaW5kZXguaW50ZXJuYWwuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRW1DIiwic291cmNlcyI6WyIvVXNlcnMvcGl5dXNoLmRhZ2FAcG9zdG1hbi5jb20vRG9jdW1lbnRzL1Byb2plY3RzL3BpeXVzaC1kYWdhL2V2YS0yL3Nlc3Npb24xLWJ1aWxkLXRvZG8tY2FsZW5kYXIvbm9kZV9tb2R1bGVzL0BzZXJ3aXN0L3dpbmRvdy9kaXN0L2luZGV4LmludGVybmFsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGlzQ3VycmVudFBhZ2VPdXRPZlNjb3BlID0gKHNjb3BlKT0+e1xuICAgIGNvbnN0IHNjb3BlVVJMID0gbmV3IFVSTChzY29wZSwgZG9jdW1lbnQuYmFzZVVSSSk7XG4gICAgY29uc3Qgc2NvcGVVUkxCYXNlUGF0aCA9IG5ldyBVUkwoXCIuL1wiLCBzY29wZVVSTC5ocmVmKS5wYXRobmFtZTtcbiAgICByZXR1cm4gIWxvY2F0aW9uLnBhdGhuYW1lLnN0YXJ0c1dpdGgoc2NvcGVVUkxCYXNlUGF0aCk7XG59O1xuXG5leHBvcnQgeyBpc0N1cnJlbnRQYWdlT3V0T2ZTY29wZSB9O1xuIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6WzBdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@serwist/window/dist/index.internal.js\n");

/***/ }),

/***/ "(ssr)/./node_modules/@serwist/window/dist/index.js":
/*!****************************************************!*\
  !*** ./node_modules/@serwist/window/dist/index.js ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Serwist: () => (/* binding */ Serwist),\n/* harmony export */   SerwistEvent: () => (/* binding */ SerwistEvent),\n/* harmony export */   messageSW: () => (/* binding */ messageSW)\n/* harmony export */ });\n/* harmony import */ var serwist_internal__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! serwist/internal */ \"(ssr)/./node_modules/serwist/dist/index.internal.js\");\n/* harmony import */ var _index_internal_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./index.internal.js */ \"(ssr)/./node_modules/@serwist/window/dist/index.internal.js\");\n\n\n\nconst messageSW = (sw, data)=>{\n    return new Promise((resolve)=>{\n        const messageChannel = new MessageChannel();\n        messageChannel.port1.onmessage = (event)=>{\n            resolve(event.data);\n        };\n        sw.postMessage(data, [\n            messageChannel.port2\n        ]);\n    });\n};\n\nclass SerwistEvent {\n    type;\n    target;\n    sw;\n    originalEvent;\n    isExternal;\n    constructor(type, props){\n        this.type = type;\n        Object.assign(this, props);\n    }\n}\n\nclass SerwistEventTarget {\n    _eventListenerRegistry = new Map();\n    addEventListener(type, listener) {\n        const foo = this._getEventListenersByType(type);\n        foo.add(listener);\n    }\n    removeEventListener(type, listener) {\n        this._getEventListenersByType(type).delete(listener);\n    }\n    dispatchEvent(event) {\n        event.target = this;\n        const listeners = this._getEventListenersByType(event.type);\n        for (const listener of listeners){\n            listener(event);\n        }\n    }\n    _getEventListenersByType(type) {\n        if (!this._eventListenerRegistry.has(type)) {\n            this._eventListenerRegistry.set(type, new Set());\n        }\n        return this._eventListenerRegistry.get(type);\n    }\n}\n\nfunction urlsMatch(url1, url2) {\n    const { href } = location;\n    return new URL(url1, href).href === new URL(url2, href).href;\n}\n\nconst WAITING_TIMEOUT_DURATION = 200;\nconst REGISTRATION_TIMEOUT_DURATION = 60000;\nconst SKIP_WAITING_MESSAGE = {\n    type: \"SKIP_WAITING\"\n};\nclass Serwist extends SerwistEventTarget {\n    _scriptURL;\n    _registerOptions = {};\n    _updateFoundCount = 0;\n    _swDeferred = new serwist_internal__WEBPACK_IMPORTED_MODULE_0__.Deferred();\n    _activeDeferred = new serwist_internal__WEBPACK_IMPORTED_MODULE_0__.Deferred();\n    _controllingDeferred = new serwist_internal__WEBPACK_IMPORTED_MODULE_0__.Deferred();\n    _registrationTime = 0;\n    _isUpdate;\n    _compatibleControllingSW;\n    _registration;\n    _sw;\n    _ownSWs = new Set();\n    _externalSW;\n    _waitingTimeout;\n    constructor(scriptURL, registerOptions = {}){\n        super();\n        this._scriptURL = scriptURL;\n        this._registerOptions = registerOptions;\n        navigator.serviceWorker.addEventListener(\"message\", this._onMessage);\n    }\n    async register({ immediate = false } = {}) {\n        if (true) {\n            if (this._registrationTime) {\n                serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Cannot re-register a Serwist instance after it has been registered. Create a new instance instead.\");\n                return;\n            }\n        }\n        if (!immediate && document.readyState !== \"complete\") {\n            await new Promise((res)=>window.addEventListener(\"load\", res));\n        }\n        this._isUpdate = Boolean(navigator.serviceWorker.controller);\n        this._compatibleControllingSW = this._getControllingSWIfCompatible();\n        this._registration = await this._registerScript();\n        if (this._compatibleControllingSW) {\n            this._sw = this._compatibleControllingSW;\n            this._activeDeferred.resolve(this._compatibleControllingSW);\n            this._controllingDeferred.resolve(this._compatibleControllingSW);\n            this._compatibleControllingSW.addEventListener(\"statechange\", this._onStateChange, {\n                once: true\n            });\n        }\n        const waitingSW = this._registration.waiting;\n        if (waitingSW && urlsMatch(waitingSW.scriptURL, this._scriptURL.toString())) {\n            this._sw = waitingSW;\n            void Promise.resolve().then(()=>{\n                this.dispatchEvent(new SerwistEvent(\"waiting\", {\n                    sw: waitingSW,\n                    wasWaitingBeforeRegister: true\n                }));\n                if (true) {\n                    serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"A service worker was already waiting to activate before this script was registered...\");\n                }\n            });\n        }\n        if (this._sw) {\n            this._swDeferred.resolve(this._sw);\n            this._ownSWs.add(this._sw);\n        }\n        if (true) {\n            serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.log(\"Successfully registered service worker.\", this._scriptURL.toString());\n            if (navigator.serviceWorker.controller) {\n                if (this._compatibleControllingSW) {\n                    serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.debug(\"A service worker with the same script URL is already controlling this page.\");\n                } else {\n                    serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.debug(\"A service worker with a different script URL is currently controlling the page. The browser is now fetching the new script now...\");\n                }\n            }\n            if ((0,_index_internal_js__WEBPACK_IMPORTED_MODULE_1__.isCurrentPageOutOfScope)(this._registerOptions.scope || this._scriptURL.toString())) {\n                serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"The current page is not in scope for the registered service worker. Was this a mistake?\");\n            }\n        }\n        this._registration.addEventListener(\"updatefound\", this._onUpdateFound);\n        navigator.serviceWorker.addEventListener(\"controllerchange\", this._onControllerChange);\n        return this._registration;\n    }\n    async update() {\n        if (!this._registration) {\n            if (true) {\n                serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.error(\"Cannot update a Serwist instance without being registered. Register the Serwist instance first.\");\n            }\n            return;\n        }\n        await this._registration.update();\n    }\n    get active() {\n        return this._activeDeferred.promise;\n    }\n    get controlling() {\n        return this._controllingDeferred.promise;\n    }\n    getSW() {\n        return this._sw !== undefined ? Promise.resolve(this._sw) : this._swDeferred.promise;\n    }\n    async messageSW(data) {\n        const sw = await this.getSW();\n        return messageSW(sw, data);\n    }\n    messageSkipWaiting() {\n        if (this._registration?.waiting) {\n            void messageSW(this._registration.waiting, SKIP_WAITING_MESSAGE);\n        }\n    }\n    _getControllingSWIfCompatible() {\n        const controller = navigator.serviceWorker.controller;\n        if (controller && urlsMatch(controller.scriptURL, this._scriptURL.toString())) {\n            return controller;\n        }\n        return undefined;\n    }\n    async _registerScript() {\n        try {\n            const reg = await navigator.serviceWorker.register(this._scriptURL, this._registerOptions);\n            this._registrationTime = performance.now();\n            return reg;\n        } catch (error) {\n            if (true) {\n                serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.error(error);\n            }\n            throw error;\n        }\n    }\n    _onUpdateFound = (originalEvent)=>{\n        const registration = this._registration;\n        const installingSW = registration.installing;\n        const updateLikelyTriggeredExternally = this._updateFoundCount > 0 || !urlsMatch(installingSW.scriptURL, this._scriptURL.toString()) || performance.now() > this._registrationTime + REGISTRATION_TIMEOUT_DURATION;\n        if (updateLikelyTriggeredExternally) {\n            this._externalSW = installingSW;\n            registration.removeEventListener(\"updatefound\", this._onUpdateFound);\n        } else {\n            this._sw = installingSW;\n            this._ownSWs.add(installingSW);\n            this._swDeferred.resolve(installingSW);\n            if (true) {\n                if (this._isUpdate) {\n                    serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.log(\"Updated service worker found. Installing now...\");\n                } else {\n                    serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.log(\"Service worker is installing...\");\n                }\n            }\n        }\n        this.dispatchEvent(new SerwistEvent(\"installing\", {\n            sw: installingSW,\n            originalEvent,\n            isExternal: updateLikelyTriggeredExternally,\n            isUpdate: this._isUpdate\n        }));\n        ++this._updateFoundCount;\n        installingSW.addEventListener(\"statechange\", this._onStateChange);\n    };\n    _onStateChange = (originalEvent)=>{\n        const registration = this._registration;\n        const sw = originalEvent.target;\n        const { state } = sw;\n        const isExternal = sw === this._externalSW;\n        const eventProps = {\n            sw,\n            isExternal,\n            originalEvent\n        };\n        if (!isExternal && this._isUpdate) {\n            eventProps.isUpdate = true;\n        }\n        this.dispatchEvent(new SerwistEvent(state, eventProps));\n        if (state === \"installed\") {\n            this._waitingTimeout = self.setTimeout(()=>{\n                if (state === \"installed\" && registration.waiting === sw) {\n                    this.dispatchEvent(new SerwistEvent(\"waiting\", eventProps));\n                    if (true) {\n                        if (isExternal) {\n                            serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"An external service worker has installed but is \" + \"waiting for this client to close before activating...\");\n                        } else {\n                            serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"The service worker has installed but is waiting \" + \"for existing clients to close before activating...\");\n                        }\n                    }\n                }\n            }, WAITING_TIMEOUT_DURATION);\n        } else if (state === \"activating\") {\n            clearTimeout(this._waitingTimeout);\n            if (!isExternal) {\n                this._activeDeferred.resolve(sw);\n            }\n        }\n        if (true) {\n            switch(state){\n                case \"installed\":\n                    if (isExternal) {\n                        serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"An external service worker has installed. \" + \"You may want to suggest users reload this page.\");\n                    } else {\n                        serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.log(\"Registered service worker installed.\");\n                    }\n                    break;\n                case \"activated\":\n                    if (isExternal) {\n                        serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"An external service worker has activated.\");\n                    } else {\n                        serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.log(\"Registered service worker activated.\");\n                        if (sw !== navigator.serviceWorker.controller) {\n                            serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.warn(\"The registered service worker is active but \" + \"not yet controlling the page. Reload or run \" + \"`clients.claim()` in the service worker.\");\n                        }\n                    }\n                    break;\n                case \"redundant\":\n                    if (sw === this._compatibleControllingSW) {\n                        serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.log(\"Previously controlling service worker now redundant!\");\n                    } else if (!isExternal) {\n                        serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.log(\"Registered service worker now redundant!\");\n                    }\n                    break;\n            }\n        }\n    };\n    _onControllerChange = (originalEvent)=>{\n        const sw = this._sw;\n        const isExternal = sw !== navigator.serviceWorker.controller;\n        this.dispatchEvent(new SerwistEvent(\"controlling\", {\n            isExternal,\n            originalEvent,\n            sw,\n            isUpdate: this._isUpdate\n        }));\n        if (!isExternal) {\n            if (true) {\n                serwist_internal__WEBPACK_IMPORTED_MODULE_0__.logger.log(\"Registered service worker now controlling this page.\");\n            }\n            this._controllingDeferred.resolve(sw);\n        }\n    };\n    _onMessage = async (originalEvent)=>{\n        const { data, ports, source } = originalEvent;\n        await this.getSW();\n        if (this._ownSWs.has(source)) {\n            this.dispatchEvent(new SerwistEvent(\"message\", {\n                data,\n                originalEvent,\n                ports,\n                sw: source\n            }));\n        }\n    };\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQHNlcndpc3Qvd2luZG93L2Rpc3QvaW5kZXguanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBb0Q7QUFDVTs7QUFFOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFlBQVksT0FBTztBQUNuQjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQixzREFBUTtBQUM5QiwwQkFBMEIsc0RBQVE7QUFDbEMsK0JBQStCLHNEQUFRO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0M7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQixvQkFBb0IsSUFBSTtBQUM3QyxZQUFZLElBQXFDO0FBQ2pEO0FBQ0EsZ0JBQWdCLG9EQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLG9CQUFvQixJQUFxQztBQUN6RCxvQkFBb0Isb0RBQU07QUFDMUI7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksSUFBcUM7QUFDakQsWUFBWSxvREFBTTtBQUNsQjtBQUNBO0FBQ0Esb0JBQW9CLG9EQUFNO0FBQzFCLGtCQUFrQjtBQUNsQixvQkFBb0Isb0RBQU07QUFDMUI7QUFDQTtBQUNBLGdCQUFnQiwyRUFBdUI7QUFDdkMsZ0JBQWdCLG9EQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0IsSUFBcUM7QUFDckQsZ0JBQWdCLG9EQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsZ0JBQWdCLElBQXFDO0FBQ3JELGdCQUFnQixvREFBTTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixJQUFxQztBQUNyRDtBQUNBLG9CQUFvQixvREFBTTtBQUMxQixrQkFBa0I7QUFDbEIsb0JBQW9CLG9EQUFNO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLFFBQVE7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixJQUFxQztBQUM3RDtBQUNBLDRCQUE0QixvREFBTTtBQUNsQywwQkFBMEI7QUFDMUIsNEJBQTRCLG9EQUFNO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksSUFBcUM7QUFDakQ7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG9EQUFNO0FBQzlCLHNCQUFzQjtBQUN0Qix3QkFBd0Isb0RBQU07QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isb0RBQU07QUFDOUIsc0JBQXNCO0FBQ3RCLHdCQUF3QixvREFBTTtBQUM5QjtBQUNBLDRCQUE0QixvREFBTTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLG9EQUFNO0FBQzlCLHNCQUFzQjtBQUN0Qix3QkFBd0Isb0RBQU07QUFDOUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxnQkFBZ0IsSUFBcUM7QUFDckQsZ0JBQWdCLG9EQUFNO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0Isc0JBQXNCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTs7QUFFNEMiLCJzb3VyY2VzIjpbIi9Vc2Vycy9waXl1c2guZGFnYUBwb3N0bWFuLmNvbS9Eb2N1bWVudHMvUHJvamVjdHMvcGl5dXNoLWRhZ2EvZXZhLTIvc2Vzc2lvbjEtYnVpbGQtdG9kby1jYWxlbmRhci9ub2RlX21vZHVsZXMvQHNlcndpc3Qvd2luZG93L2Rpc3QvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVmZXJyZWQsIGxvZ2dlciB9IGZyb20gJ3Nlcndpc3QvaW50ZXJuYWwnO1xuaW1wb3J0IHsgaXNDdXJyZW50UGFnZU91dE9mU2NvcGUgfSBmcm9tICcuL2luZGV4LmludGVybmFsLmpzJztcblxuY29uc3QgbWVzc2FnZVNXID0gKHN3LCBkYXRhKT0+e1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSk9PntcbiAgICAgICAgY29uc3QgbWVzc2FnZUNoYW5uZWwgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKTtcbiAgICAgICAgbWVzc2FnZUNoYW5uZWwucG9ydDEub25tZXNzYWdlID0gKGV2ZW50KT0+e1xuICAgICAgICAgICAgcmVzb2x2ZShldmVudC5kYXRhKTtcbiAgICAgICAgfTtcbiAgICAgICAgc3cucG9zdE1lc3NhZ2UoZGF0YSwgW1xuICAgICAgICAgICAgbWVzc2FnZUNoYW5uZWwucG9ydDJcbiAgICAgICAgXSk7XG4gICAgfSk7XG59O1xuXG5jbGFzcyBTZXJ3aXN0RXZlbnQge1xuICAgIHR5cGU7XG4gICAgdGFyZ2V0O1xuICAgIHN3O1xuICAgIG9yaWdpbmFsRXZlbnQ7XG4gICAgaXNFeHRlcm5hbDtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlLCBwcm9wcyl7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgcHJvcHMpO1xuICAgIH1cbn1cblxuY2xhc3MgU2Vyd2lzdEV2ZW50VGFyZ2V0IHtcbiAgICBfZXZlbnRMaXN0ZW5lclJlZ2lzdHJ5ID0gbmV3IE1hcCgpO1xuICAgIGFkZEV2ZW50TGlzdGVuZXIodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgICAgY29uc3QgZm9vID0gdGhpcy5fZ2V0RXZlbnRMaXN0ZW5lcnNCeVR5cGUodHlwZSk7XG4gICAgICAgIGZvby5hZGQobGlzdGVuZXIpO1xuICAgIH1cbiAgICByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMuX2dldEV2ZW50TGlzdGVuZXJzQnlUeXBlKHR5cGUpLmRlbGV0ZShsaXN0ZW5lcik7XG4gICAgfVxuICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQudGFyZ2V0ID0gdGhpcztcbiAgICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fZ2V0RXZlbnRMaXN0ZW5lcnNCeVR5cGUoZXZlbnQudHlwZSk7XG4gICAgICAgIGZvciAoY29uc3QgbGlzdGVuZXIgb2YgbGlzdGVuZXJzKXtcbiAgICAgICAgICAgIGxpc3RlbmVyKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfZ2V0RXZlbnRMaXN0ZW5lcnNCeVR5cGUodHlwZSkge1xuICAgICAgICBpZiAoIXRoaXMuX2V2ZW50TGlzdGVuZXJSZWdpc3RyeS5oYXModHlwZSkpIHtcbiAgICAgICAgICAgIHRoaXMuX2V2ZW50TGlzdGVuZXJSZWdpc3RyeS5zZXQodHlwZSwgbmV3IFNldCgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRMaXN0ZW5lclJlZ2lzdHJ5LmdldCh0eXBlKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIHVybHNNYXRjaCh1cmwxLCB1cmwyKSB7XG4gICAgY29uc3QgeyBocmVmIH0gPSBsb2NhdGlvbjtcbiAgICByZXR1cm4gbmV3IFVSTCh1cmwxLCBocmVmKS5ocmVmID09PSBuZXcgVVJMKHVybDIsIGhyZWYpLmhyZWY7XG59XG5cbmNvbnN0IFdBSVRJTkdfVElNRU9VVF9EVVJBVElPTiA9IDIwMDtcbmNvbnN0IFJFR0lTVFJBVElPTl9USU1FT1VUX0RVUkFUSU9OID0gNjAwMDA7XG5jb25zdCBTS0lQX1dBSVRJTkdfTUVTU0FHRSA9IHtcbiAgICB0eXBlOiBcIlNLSVBfV0FJVElOR1wiXG59O1xuY2xhc3MgU2Vyd2lzdCBleHRlbmRzIFNlcndpc3RFdmVudFRhcmdldCB7XG4gICAgX3NjcmlwdFVSTDtcbiAgICBfcmVnaXN0ZXJPcHRpb25zID0ge307XG4gICAgX3VwZGF0ZUZvdW5kQ291bnQgPSAwO1xuICAgIF9zd0RlZmVycmVkID0gbmV3IERlZmVycmVkKCk7XG4gICAgX2FjdGl2ZURlZmVycmVkID0gbmV3IERlZmVycmVkKCk7XG4gICAgX2NvbnRyb2xsaW5nRGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTtcbiAgICBfcmVnaXN0cmF0aW9uVGltZSA9IDA7XG4gICAgX2lzVXBkYXRlO1xuICAgIF9jb21wYXRpYmxlQ29udHJvbGxpbmdTVztcbiAgICBfcmVnaXN0cmF0aW9uO1xuICAgIF9zdztcbiAgICBfb3duU1dzID0gbmV3IFNldCgpO1xuICAgIF9leHRlcm5hbFNXO1xuICAgIF93YWl0aW5nVGltZW91dDtcbiAgICBjb25zdHJ1Y3RvcihzY3JpcHRVUkwsIHJlZ2lzdGVyT3B0aW9ucyA9IHt9KXtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fc2NyaXB0VVJMID0gc2NyaXB0VVJMO1xuICAgICAgICB0aGlzLl9yZWdpc3Rlck9wdGlvbnMgPSByZWdpc3Rlck9wdGlvbnM7XG4gICAgICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIHRoaXMuX29uTWVzc2FnZSk7XG4gICAgfVxuICAgIGFzeW5jIHJlZ2lzdGVyKHsgaW1tZWRpYXRlID0gZmFsc2UgfSA9IHt9KSB7XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9yZWdpc3RyYXRpb25UaW1lKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKFwiQ2Fubm90IHJlLXJlZ2lzdGVyIGEgU2Vyd2lzdCBpbnN0YW5jZSBhZnRlciBpdCBoYXMgYmVlbiByZWdpc3RlcmVkLiBDcmVhdGUgYSBuZXcgaW5zdGFuY2UgaW5zdGVhZC5cIik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghaW1tZWRpYXRlICYmIGRvY3VtZW50LnJlYWR5U3RhdGUgIT09IFwiY29tcGxldGVcIikge1xuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlcyk9PndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCByZXMpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9pc1VwZGF0ZSA9IEJvb2xlYW4obmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcik7XG4gICAgICAgIHRoaXMuX2NvbXBhdGlibGVDb250cm9sbGluZ1NXID0gdGhpcy5fZ2V0Q29udHJvbGxpbmdTV0lmQ29tcGF0aWJsZSgpO1xuICAgICAgICB0aGlzLl9yZWdpc3RyYXRpb24gPSBhd2FpdCB0aGlzLl9yZWdpc3RlclNjcmlwdCgpO1xuICAgICAgICBpZiAodGhpcy5fY29tcGF0aWJsZUNvbnRyb2xsaW5nU1cpIHtcbiAgICAgICAgICAgIHRoaXMuX3N3ID0gdGhpcy5fY29tcGF0aWJsZUNvbnRyb2xsaW5nU1c7XG4gICAgICAgICAgICB0aGlzLl9hY3RpdmVEZWZlcnJlZC5yZXNvbHZlKHRoaXMuX2NvbXBhdGlibGVDb250cm9sbGluZ1NXKTtcbiAgICAgICAgICAgIHRoaXMuX2NvbnRyb2xsaW5nRGVmZXJyZWQucmVzb2x2ZSh0aGlzLl9jb21wYXRpYmxlQ29udHJvbGxpbmdTVyk7XG4gICAgICAgICAgICB0aGlzLl9jb21wYXRpYmxlQ29udHJvbGxpbmdTVy5hZGRFdmVudExpc3RlbmVyKFwic3RhdGVjaGFuZ2VcIiwgdGhpcy5fb25TdGF0ZUNoYW5nZSwge1xuICAgICAgICAgICAgICAgIG9uY2U6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHdhaXRpbmdTVyA9IHRoaXMuX3JlZ2lzdHJhdGlvbi53YWl0aW5nO1xuICAgICAgICBpZiAod2FpdGluZ1NXICYmIHVybHNNYXRjaCh3YWl0aW5nU1cuc2NyaXB0VVJMLCB0aGlzLl9zY3JpcHRVUkwudG9TdHJpbmcoKSkpIHtcbiAgICAgICAgICAgIHRoaXMuX3N3ID0gd2FpdGluZ1NXO1xuICAgICAgICAgICAgdm9pZCBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpPT57XG4gICAgICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBTZXJ3aXN0RXZlbnQoXCJ3YWl0aW5nXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc3c6IHdhaXRpbmdTVyxcbiAgICAgICAgICAgICAgICAgICAgd2FzV2FpdGluZ0JlZm9yZVJlZ2lzdGVyOiB0cnVlXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oXCJBIHNlcnZpY2Ugd29ya2VyIHdhcyBhbHJlYWR5IHdhaXRpbmcgdG8gYWN0aXZhdGUgYmVmb3JlIHRoaXMgc2NyaXB0IHdhcyByZWdpc3RlcmVkLi4uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9zdykge1xuICAgICAgICAgICAgdGhpcy5fc3dEZWZlcnJlZC5yZXNvbHZlKHRoaXMuX3N3KTtcbiAgICAgICAgICAgIHRoaXMuX293blNXcy5hZGQodGhpcy5fc3cpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgIGxvZ2dlci5sb2coXCJTdWNjZXNzZnVsbHkgcmVnaXN0ZXJlZCBzZXJ2aWNlIHdvcmtlci5cIiwgdGhpcy5fc2NyaXB0VVJMLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY29tcGF0aWJsZUNvbnRyb2xsaW5nU1cpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFwiQSBzZXJ2aWNlIHdvcmtlciB3aXRoIHRoZSBzYW1lIHNjcmlwdCBVUkwgaXMgYWxyZWFkeSBjb250cm9sbGluZyB0aGlzIHBhZ2UuXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcIkEgc2VydmljZSB3b3JrZXIgd2l0aCBhIGRpZmZlcmVudCBzY3JpcHQgVVJMIGlzIGN1cnJlbnRseSBjb250cm9sbGluZyB0aGUgcGFnZS4gVGhlIGJyb3dzZXIgaXMgbm93IGZldGNoaW5nIHRoZSBuZXcgc2NyaXB0IG5vdy4uLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaXNDdXJyZW50UGFnZU91dE9mU2NvcGUodGhpcy5fcmVnaXN0ZXJPcHRpb25zLnNjb3BlIHx8IHRoaXMuX3NjcmlwdFVSTC50b1N0cmluZygpKSkge1xuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKFwiVGhlIGN1cnJlbnQgcGFnZSBpcyBub3QgaW4gc2NvcGUgZm9yIHRoZSByZWdpc3RlcmVkIHNlcnZpY2Ugd29ya2VyLiBXYXMgdGhpcyBhIG1pc3Rha2U/XCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3JlZ2lzdHJhdGlvbi5hZGRFdmVudExpc3RlbmVyKFwidXBkYXRlZm91bmRcIiwgdGhpcy5fb25VcGRhdGVGb3VuZCk7XG4gICAgICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJjb250cm9sbGVyY2hhbmdlXCIsIHRoaXMuX29uQ29udHJvbGxlckNoYW5nZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZWdpc3RyYXRpb247XG4gICAgfVxuICAgIGFzeW5jIHVwZGF0ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9yZWdpc3RyYXRpb24pIHtcbiAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoXCJDYW5ub3QgdXBkYXRlIGEgU2Vyd2lzdCBpbnN0YW5jZSB3aXRob3V0IGJlaW5nIHJlZ2lzdGVyZWQuIFJlZ2lzdGVyIHRoZSBTZXJ3aXN0IGluc3RhbmNlIGZpcnN0LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLl9yZWdpc3RyYXRpb24udXBkYXRlKCk7XG4gICAgfVxuICAgIGdldCBhY3RpdmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9hY3RpdmVEZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cbiAgICBnZXQgY29udHJvbGxpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb250cm9sbGluZ0RlZmVycmVkLnByb21pc2U7XG4gICAgfVxuICAgIGdldFNXKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc3cgIT09IHVuZGVmaW5lZCA/IFByb21pc2UucmVzb2x2ZSh0aGlzLl9zdykgOiB0aGlzLl9zd0RlZmVycmVkLnByb21pc2U7XG4gICAgfVxuICAgIGFzeW5jIG1lc3NhZ2VTVyhkYXRhKSB7XG4gICAgICAgIGNvbnN0IHN3ID0gYXdhaXQgdGhpcy5nZXRTVygpO1xuICAgICAgICByZXR1cm4gbWVzc2FnZVNXKHN3LCBkYXRhKTtcbiAgICB9XG4gICAgbWVzc2FnZVNraXBXYWl0aW5nKCkge1xuICAgICAgICBpZiAodGhpcy5fcmVnaXN0cmF0aW9uPy53YWl0aW5nKSB7XG4gICAgICAgICAgICB2b2lkIG1lc3NhZ2VTVyh0aGlzLl9yZWdpc3RyYXRpb24ud2FpdGluZywgU0tJUF9XQUlUSU5HX01FU1NBR0UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9nZXRDb250cm9sbGluZ1NXSWZDb21wYXRpYmxlKCkge1xuICAgICAgICBjb25zdCBjb250cm9sbGVyID0gbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcjtcbiAgICAgICAgaWYgKGNvbnRyb2xsZXIgJiYgdXJsc01hdGNoKGNvbnRyb2xsZXIuc2NyaXB0VVJMLCB0aGlzLl9zY3JpcHRVUkwudG9TdHJpbmcoKSkpIHtcbiAgICAgICAgICAgIHJldHVybiBjb250cm9sbGVyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGFzeW5jIF9yZWdpc3RlclNjcmlwdCgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlZyA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKHRoaXMuX3NjcmlwdFVSTCwgdGhpcy5fcmVnaXN0ZXJPcHRpb25zKTtcbiAgICAgICAgICAgIHRoaXMuX3JlZ2lzdHJhdGlvblRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgICAgIHJldHVybiByZWc7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9vblVwZGF0ZUZvdW5kID0gKG9yaWdpbmFsRXZlbnQpPT57XG4gICAgICAgIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IHRoaXMuX3JlZ2lzdHJhdGlvbjtcbiAgICAgICAgY29uc3QgaW5zdGFsbGluZ1NXID0gcmVnaXN0cmF0aW9uLmluc3RhbGxpbmc7XG4gICAgICAgIGNvbnN0IHVwZGF0ZUxpa2VseVRyaWdnZXJlZEV4dGVybmFsbHkgPSB0aGlzLl91cGRhdGVGb3VuZENvdW50ID4gMCB8fCAhdXJsc01hdGNoKGluc3RhbGxpbmdTVy5zY3JpcHRVUkwsIHRoaXMuX3NjcmlwdFVSTC50b1N0cmluZygpKSB8fCBwZXJmb3JtYW5jZS5ub3coKSA+IHRoaXMuX3JlZ2lzdHJhdGlvblRpbWUgKyBSRUdJU1RSQVRJT05fVElNRU9VVF9EVVJBVElPTjtcbiAgICAgICAgaWYgKHVwZGF0ZUxpa2VseVRyaWdnZXJlZEV4dGVybmFsbHkpIHtcbiAgICAgICAgICAgIHRoaXMuX2V4dGVybmFsU1cgPSBpbnN0YWxsaW5nU1c7XG4gICAgICAgICAgICByZWdpc3RyYXRpb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInVwZGF0ZWZvdW5kXCIsIHRoaXMuX29uVXBkYXRlRm91bmQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fc3cgPSBpbnN0YWxsaW5nU1c7XG4gICAgICAgICAgICB0aGlzLl9vd25TV3MuYWRkKGluc3RhbGxpbmdTVyk7XG4gICAgICAgICAgICB0aGlzLl9zd0RlZmVycmVkLnJlc29sdmUoaW5zdGFsbGluZ1NXKTtcbiAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5faXNVcGRhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIlVwZGF0ZWQgc2VydmljZSB3b3JrZXIgZm91bmQuIEluc3RhbGxpbmcgbm93Li4uXCIpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coXCJTZXJ2aWNlIHdvcmtlciBpcyBpbnN0YWxsaW5nLi4uXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQobmV3IFNlcndpc3RFdmVudChcImluc3RhbGxpbmdcIiwge1xuICAgICAgICAgICAgc3c6IGluc3RhbGxpbmdTVyxcbiAgICAgICAgICAgIG9yaWdpbmFsRXZlbnQsXG4gICAgICAgICAgICBpc0V4dGVybmFsOiB1cGRhdGVMaWtlbHlUcmlnZ2VyZWRFeHRlcm5hbGx5LFxuICAgICAgICAgICAgaXNVcGRhdGU6IHRoaXMuX2lzVXBkYXRlXG4gICAgICAgIH0pKTtcbiAgICAgICAgKyt0aGlzLl91cGRhdGVGb3VuZENvdW50O1xuICAgICAgICBpbnN0YWxsaW5nU1cuYWRkRXZlbnRMaXN0ZW5lcihcInN0YXRlY2hhbmdlXCIsIHRoaXMuX29uU3RhdGVDaGFuZ2UpO1xuICAgIH07XG4gICAgX29uU3RhdGVDaGFuZ2UgPSAob3JpZ2luYWxFdmVudCk9PntcbiAgICAgICAgY29uc3QgcmVnaXN0cmF0aW9uID0gdGhpcy5fcmVnaXN0cmF0aW9uO1xuICAgICAgICBjb25zdCBzdyA9IG9yaWdpbmFsRXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCB7IHN0YXRlIH0gPSBzdztcbiAgICAgICAgY29uc3QgaXNFeHRlcm5hbCA9IHN3ID09PSB0aGlzLl9leHRlcm5hbFNXO1xuICAgICAgICBjb25zdCBldmVudFByb3BzID0ge1xuICAgICAgICAgICAgc3csXG4gICAgICAgICAgICBpc0V4dGVybmFsLFxuICAgICAgICAgICAgb3JpZ2luYWxFdmVudFxuICAgICAgICB9O1xuICAgICAgICBpZiAoIWlzRXh0ZXJuYWwgJiYgdGhpcy5faXNVcGRhdGUpIHtcbiAgICAgICAgICAgIGV2ZW50UHJvcHMuaXNVcGRhdGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgU2Vyd2lzdEV2ZW50KHN0YXRlLCBldmVudFByb3BzKSk7XG4gICAgICAgIGlmIChzdGF0ZSA9PT0gXCJpbnN0YWxsZWRcIikge1xuICAgICAgICAgICAgdGhpcy5fd2FpdGluZ1RpbWVvdXQgPSBzZWxmLnNldFRpbWVvdXQoKCk9PntcbiAgICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09IFwiaW5zdGFsbGVkXCIgJiYgcmVnaXN0cmF0aW9uLndhaXRpbmcgPT09IHN3KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgU2Vyd2lzdEV2ZW50KFwid2FpdGluZ1wiLCBldmVudFByb3BzKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gXCJwcm9kdWN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0V4dGVybmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oXCJBbiBleHRlcm5hbCBzZXJ2aWNlIHdvcmtlciBoYXMgaW5zdGFsbGVkIGJ1dCBpcyBcIiArIFwid2FpdGluZyBmb3IgdGhpcyBjbGllbnQgdG8gY2xvc2UgYmVmb3JlIGFjdGl2YXRpbmcuLi5cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKFwiVGhlIHNlcnZpY2Ugd29ya2VyIGhhcyBpbnN0YWxsZWQgYnV0IGlzIHdhaXRpbmcgXCIgKyBcImZvciBleGlzdGluZyBjbGllbnRzIHRvIGNsb3NlIGJlZm9yZSBhY3RpdmF0aW5nLi4uXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgV0FJVElOR19USU1FT1VUX0RVUkFUSU9OKTtcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PT0gXCJhY3RpdmF0aW5nXCIpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl93YWl0aW5nVGltZW91dCk7XG4gICAgICAgICAgICBpZiAoIWlzRXh0ZXJuYWwpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hY3RpdmVEZWZlcnJlZC5yZXNvbHZlKHN3KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgICAgICAgICBzd2l0Y2goc3RhdGUpe1xuICAgICAgICAgICAgICAgIGNhc2UgXCJpbnN0YWxsZWRcIjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRXh0ZXJuYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKFwiQW4gZXh0ZXJuYWwgc2VydmljZSB3b3JrZXIgaGFzIGluc3RhbGxlZC4gXCIgKyBcIllvdSBtYXkgd2FudCB0byBzdWdnZXN0IHVzZXJzIHJlbG9hZCB0aGlzIHBhZ2UuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIlJlZ2lzdGVyZWQgc2VydmljZSB3b3JrZXIgaW5zdGFsbGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiYWN0aXZhdGVkXCI6XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0V4dGVybmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybihcIkFuIGV4dGVybmFsIHNlcnZpY2Ugd29ya2VyIGhhcyBhY3RpdmF0ZWQuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZyhcIlJlZ2lzdGVyZWQgc2VydmljZSB3b3JrZXIgYWN0aXZhdGVkLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdyAhPT0gbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuY29udHJvbGxlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKFwiVGhlIHJlZ2lzdGVyZWQgc2VydmljZSB3b3JrZXIgaXMgYWN0aXZlIGJ1dCBcIiArIFwibm90IHlldCBjb250cm9sbGluZyB0aGUgcGFnZS4gUmVsb2FkIG9yIHJ1biBcIiArIFwiYGNsaWVudHMuY2xhaW0oKWAgaW4gdGhlIHNlcnZpY2Ugd29ya2VyLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwicmVkdW5kYW50XCI6XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdyA9PT0gdGhpcy5fY29tcGF0aWJsZUNvbnRyb2xsaW5nU1cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coXCJQcmV2aW91c2x5IGNvbnRyb2xsaW5nIHNlcnZpY2Ugd29ya2VyIG5vdyByZWR1bmRhbnQhXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFpc0V4dGVybmFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKFwiUmVnaXN0ZXJlZCBzZXJ2aWNlIHdvcmtlciBub3cgcmVkdW5kYW50IVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgX29uQ29udHJvbGxlckNoYW5nZSA9IChvcmlnaW5hbEV2ZW50KT0+e1xuICAgICAgICBjb25zdCBzdyA9IHRoaXMuX3N3O1xuICAgICAgICBjb25zdCBpc0V4dGVybmFsID0gc3cgIT09IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmNvbnRyb2xsZXI7XG4gICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChuZXcgU2Vyd2lzdEV2ZW50KFwiY29udHJvbGxpbmdcIiwge1xuICAgICAgICAgICAgaXNFeHRlcm5hbCxcbiAgICAgICAgICAgIG9yaWdpbmFsRXZlbnQsXG4gICAgICAgICAgICBzdyxcbiAgICAgICAgICAgIGlzVXBkYXRlOiB0aGlzLl9pc1VwZGF0ZVxuICAgICAgICB9KSk7XG4gICAgICAgIGlmICghaXNFeHRlcm5hbCkge1xuICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coXCJSZWdpc3RlcmVkIHNlcnZpY2Ugd29ya2VyIG5vdyBjb250cm9sbGluZyB0aGlzIHBhZ2UuXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY29udHJvbGxpbmdEZWZlcnJlZC5yZXNvbHZlKHN3KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgX29uTWVzc2FnZSA9IGFzeW5jIChvcmlnaW5hbEV2ZW50KT0+e1xuICAgICAgICBjb25zdCB7IGRhdGEsIHBvcnRzLCBzb3VyY2UgfSA9IG9yaWdpbmFsRXZlbnQ7XG4gICAgICAgIGF3YWl0IHRoaXMuZ2V0U1coKTtcbiAgICAgICAgaWYgKHRoaXMuX293blNXcy5oYXMoc291cmNlKSkge1xuICAgICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KG5ldyBTZXJ3aXN0RXZlbnQoXCJtZXNzYWdlXCIsIHtcbiAgICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsRXZlbnQsXG4gICAgICAgICAgICAgICAgcG9ydHMsXG4gICAgICAgICAgICAgICAgc3c6IHNvdXJjZVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuZXhwb3J0IHsgU2Vyd2lzdCwgU2Vyd2lzdEV2ZW50LCBtZXNzYWdlU1cgfTtcbiJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOlswXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@serwist/window/dist/index.js\n");

/***/ })

};
;